# TpRedis - Typecho Redis缓存插件

## 功能

为Typecho博客提供基于Redis的缓存功能，显著减轻网站并发压力，提高访问速度。

## 特点

1. 支持**Redis**和**MySQL**两种缓存驱动
2. 支持PHP 7.5+和最新的Redis扩展
3. 支持MySQL 7/8+版本
4. 支持SSL网站
5. 灵活配置缓存选项
6. 自动清除过期缓存

## 注意事项

1. 使用非原生评论系统可能会导致评论后缓存未及时更新
2. 插件会自动排除已登录用户，不对管理员生效
3. 如遇问题请在[www.fungj.com](http://www.fungj.com)反馈

## 使用说明

### 安装方法

1. 下载插件，确保文件夹名为`TpRedis`
2. 将插件目录上传到Typecho的`usr/plugins/`目录下
3. 在Typecho后台启用插件
4. 配置插件选项

### PHP Redis扩展安装

使用Redis缓存驱动需要先安装PHP的Redis扩展：

1. **Windows环境**：
   - 在PHP目录的`ext`文件夹中添加`php_redis.dll`
   - 在php.ini中添加`extension=redis`或`extension=php_redis.dll`
   - 重启Web服务器

2. **Linux环境**：
   - 使用PECL安装：`pecl install redis`
   - 或使用包管理器：`apt-get install php-redis`（Debian/Ubuntu）或`yum install php-redis`（CentOS）
   - 在php.ini中添加`extension=redis.so`
   - 重启Web服务器

如果无法安装Redis扩展，插件会自动使用MySQL作为缓存驱动。

### 后台设置

插件提供了丰富的配置选项：

1. **需要缓存的页面**：选择需要开启缓存的页面类型
2. **是否对已登录用户失效**：建议开启，避免管理员操作受缓存影响
3. **是否支持SSL**：如果网站使用HTTPS，请开启此选项
4. **缓存驱动**：选择Redis或MySQL作为缓存存储方式
5. **缓存过期时间**：设置缓存的有效期，单位为秒
6. **Redis设置**：配置Redis服务器的连接信息
7. **缓存键前缀**：用于区分不同网站的缓存数据
8. **开启调试**：显示缓存相关信息，便于排查问题
9. **清除所有缓存**：需要时可一键清空所有缓存数据

### 缓存更新机制

**以下操作会触发缓存更新**：

- 来自原生评论系统的评论
- 后台文章或页面更新
- 缓存到期自动失效

### Redis配置

请确保服务器已安装Redis服务和PHP的Redis扩展。

## 性能提升

Redis缓存可以显著提高网站性能，特别是在访问量较大的情况下效果更为明显。理论上可支持每天数千万的PV而服务器负载不会过高。

## 版本历史

- v1.0.2: 新增评论审核缓存刷新
  - 新增配置选项：评论审核后自动刷新对应页面缓存或整站缓存
  - 解决开启评论审核时，审核通过后前端缓存未更新的问题
  - 优化缓存一致性，确保新评论及时显示

- v1.0.1: 兼容性更新
  - 修复配置保存问题
  - 增加PHP Redis扩展检测
  - 自动切换到MySQL驱动（当Redis扩展未安装时）
  - 改进错误处理和提示

- v1.0.0: 初始版本，基于老高的TpCache插件优化升级
  - 支持PHP 7.5+
  - 支持最新的Redis版本
  - 支持MySQL 7/8+
  - 移除Memcache缓存
  - 增强配置选项

## 升级说明

从旧版本升级请先**禁用插件**再升级，避免出现不必要的问题。

## 关于作者

- 作者：风之翼灵
- 网站：[www.fungj.com](http://www.fungj.com)
- 邮箱：office@fungj.com

## 版权信息

本插件基于老高的TpCache插件进行优化升级，保留原作者的版权信息。

